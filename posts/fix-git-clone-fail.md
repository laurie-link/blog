---
title: 如何解决Git老是拉取到一半失败的问题
date: 2024-11-14
tags: ["技术", "开发"]
category: 技术分享
---

一般可以在终端给Git配置解决这个问题，使用到的命令（这是给HTTP和HTTPS配置代理）：

“<代理端口>"一般可以在魔法软件的设置里找到

另外现在大多数魔法软件连接的时候都会配置本地代理，所以比如说Windows也可以在系统设置 -> 代理 -> 编辑代理设置中查看

![notion image](https://img.aiexplorernote.com/pic/local-proxy-port-windows.png?t=13ed1f9c-c2a3-800b-8ba2-fa67575b6e07)

查看当前Git代理设置的命令：

![notion image](https://img.aiexplorernote.com/pic/view-current-git-proxy-settings.png?t=13ed1f9c-c2a3-8050-ad2c-cf3b8e191198)

小提示：你也可以用这个命令查看Git的所有设置，包括用户，用户邮箱等：

如果设置了 Git 代理后仍然拉取失败，可能是你的魔法软件配置有问题，可以尝试通过谷歌等网站验证代理连接是否正常

也有可能是要拉取的文件太大，这种情况下可以尝试以下几种办法：

## 1\. 浅克隆（Shallow Clone）

浅克隆是指在克隆仓库时，只拉取项目的**最新提交内容** ，而不包含完整的历史记录。这样可以大幅度减少下载的数据量，适用于只需要最新代码而不需要查看项目历史记录的情况

要使用浅克隆，可以通过在克隆命令中添加 --depth 参数。比如“--depth=1"表示只克隆最新的 1 次提交

如果之后需要更多的历史记录，可以通过增加 depth 值来增量拉取更多历史记录：

浅克隆适用于只关心项目最新内容，不需要查看整个提交历史的情况，尤其是在大项目中，可以大大减少克隆时间和数据量

## 2\. 拉取特定分支

Git 默认会克隆整个仓库的所有分支，但有时我们**只需要其中一个分支** 的内容。拉取特定分支可以减少不必要的分支数据传输，节省空间和时间

要拉取特定分支，可以使用 ”-b <分支名称> \--single-branch“ 选项，指定克隆的分支名称，且只拉取该分支。

这个方法适用于当你只需要工作在某一个分支上，而不需要其他分支的内容时，可以使用拉取特定分支来减少数据传输

## 3\. 增量拉取（Fetch and Pull）

增量拉取是指在已经存在的本地仓库中，获取**自上次拉取以来的新增提交** ，而不是重新克隆整个仓库。这样可以只拉取增量更新的数据，从而避免重复下载已存在的文件

注意：浅克隆和增量拉取的区别在于是否已将远程仓库拉取到本地。浅克隆是还未将远程仓库拉取到本地，是在这种情况下使用“--depth"参数拉取指定数量的最新提交。而增量拉取是在已经将远程仓库拉取到本地后，只拉取从上次拉取以来的提交

使用增量拉取是指：

  * 先使用 ”git fetch“ 命令获取远程仓库中的更新内容

  * 然后通过 ”git pull“ 将更新合并到本地分支

增量拉取适用于已有本地仓库的情况，当仓库已有文件，只需更新新提交内容时，增量拉取可以减少网络流量，提高效率

## 4\. 稀疏签出（Sparse Checkout）

稀疏签出是 Git 提供的一种方法，用于仅拉取仓库中部分文件夹或路径下的内容，而不是整个仓库的全部文件。这对于一些大项目或只需要特定目录的情况非常有用，因为它可以显著减少拉取的数据量，加快克隆速度。

**如何使用稀疏签出** ：

  * 首先使用 “--no-checkout” 克隆仓库，这样 Git 不会立即拉取所有文件。

  * 然后通过 “git sparse-checkout init” 命令启动稀疏签出模式。

  * 接着用 “git sparse-checkout set <目录路径>” 指定需要签出的目录。

  * 最后，使用 “git checkout <分支名称>” 来签出所需的内容。

示例代码：

稀疏迁出适用于如果你只想下载项目中某个特定文件夹的内容，不需要完整的历史记录。比如在大型项目中，只需要一个 “docs” 文件夹的内容，那么使用稀疏签出可以显著加快下载速度

## 5\. 调整 “http.postBuffer”

“http.postBuffer” 是 Git 中的一个配置项，用于设置 Git 使用 HTTP 协议传输数据时的缓存大小。默认情况下，Git 的 “http.postBuffer” 大小是 1 MB，这在上传或下载大文件时可能不够，会导致网络连接中断或数据传输失败

可以通过增加 ”http.postBuffer“ 大小来允许更大的文件传输，通常设置为 500 MB 比较合适：

**注意** ：524288000 是以字节为单位的大小，500 MB = 524288000 字节。你可以通过“git config --list"命令查看当前Git的”http.postBuffer"值

当你在克隆、拉取、推送过程中遇到类似“RPC failed; curl 18 transfer closed with outstanding read data remaining”的错误提示时，增大 "http.postBuffer" 可以解决由于文件过大引起的传输问题